{% extends "base.html" %}

{% block content %}
<h2>Problema: {{ problema }}</h2>
<p>Fase {{ fase|upper }} – Ano {{ ano }} – Nível {{ nivel|replace('p', '') }}</p>

<hr>

<h3>Enunciado</h3>
<iframe 
    src="{{ pdf_url }}" 
    width="100%" 
    height="600px" 
    style="border: 1px solid #ccc; border-radius: 8px;">
</iframe>

<div style="margin-top: 12px;">
  <label for="language">Linguagem:</label>
  <select id="language" required>
    <option value="py" selected>Python 3 (.py)</option>
    <option value="c">C (.c)</option>
    <option value="cpp">C++ (.cpp)</option>
    <option value="java">Java (.java)</option>
    <option value="pas">Pascal (.pas)</option>
    <option value="js">Javascript (.js)</option>
  </select>
</div>


<h3>Envie seu código</h3>
<textarea id="codigo" name="codigo" style="width:100%; height:200px; font-family: monospace;"></textarea>

<div style="margin-top: 15px;">
    <label>Limite de tempo (segundos):</label>
    <input type="number" id="limiteTempo" min="1" max="10" value="1" required>
    <br>
    <label>Limite de memória (MB):</label>
    <input type="number" id="limiteMemoria" min="16" max="1024" value="256" required>
</div>

<div style="margin-top: 15px;">
    <button onclick="enviarCodigo()" class="btn btn-success">Enviar</button>
</div>

<div id="results" style="margin-top: 20px;"></div>

<script>

const zip_url = "{{ zip_url }}"

const JUDGE0_URL = "https://judge.darlon.com.br";

const toBase64 = str => btoa(unescape(encodeURIComponent(str)));
const fromBase64 = str => decodeURIComponent(escape(atob(str)));

const languageIds = {
        py: 71,   // Python 2.7.17
        c: 50,    // Basic (FBC 1.07.1)
        cpp: 76,  // C++ (Clang 7.0.1)
        java: 62, // Java (OpenJDK 13.0.1)
        pas: 67,  // Pascal (FPC 3.0.4)
        js: 63    // JavaScript (Node.js 12.14.0)
    };

function enviarCodigo() {
    const codigo = document.getElementById('codigo').value.trim();
    const limiteTempo = Number(document.getElementById('limiteTempo').value);
    const limiteMemoria = Number(document.getElementById('limiteMemoria').value);
    const linguagem = document.getElementById('language').value;

    if (!linguagem) {
        alert("Por favor, insira uma linguagem antes de enviar!");
        return;
    }

    if (!codigo) {
        alert("Por favor, insira o código antes de enviar!");
        return;
    }

    if (
        isNaN(limiteTempo) || isNaN(limiteMemoria) ||
        limiteTempo < 1 || limiteTempo > 10 ||
        limiteMemoria < 16 || limiteMemoria > 1024
    ) {
        alert("Os limites devem estar entre 1–10 segundos e 16–1024 MB!");
        return;
    }

    const tempoInput = document.getElementById('limiteTempo');
    const memoriaInput = document.getElementById('limiteMemoria');
    tempoInput.value = Math.max(1, Math.min(limiteTempo, 10));
    memoriaInput.value = Math.max(16, Math.min(limiteMemoria, 1024));

    // (opcional) registrar no servidor
    alert("Código enviado com sucesso!\n" +
          "Tempo: " + tempoInput.value + "s\n" +
          "Memória: " + memoriaInput.value + "MB");

    const resultsDiv = document.getElementById("results");
    resultsDiv.innerHTML = "<h3>Baixando e testando..." + zip_url + "</h3>";
    
}
</script>
{% endblock %}
